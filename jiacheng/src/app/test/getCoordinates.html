<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script type="text/javascript" src="//api.map.baidu.com/api?type=webgl&v=1.0&ak=ioO6dD2uRuBucqNzcccfSeaU2xgjlgdk"></script>
    <title>本地搜索的数据接口</title>
</head>
<body>
<div id="l-map"></div>
<div id="app">{{dealerName}}
    <div v-on:click="text111">点击</div>
</div>

</body>
</html>
<script type="text/javascript">

    var app = new Vue({
        el:'#app',
        data:{
            dealerName:'',
        },
        methods:{
            text111:function (){
                // console.log(s)
            }
        }
    })



    function getPosition () {
        return new Promise((resolve, reject) => {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function (position) {
                    let latitude = position.coords.latitude
                    let longitude = position.coords.longitude
                    let data = {
                        latitude: latitude,
                        longitude: longitude
                    }
                    resolve(data)
                }, function () {
                    reject(arguments)
                })
            } else {
                reject('你的浏览器不支持当前地理位置信息获取')
            }
        })
    }

    getPosition().then(result => {
        // {latitude: 30.31, longitude: 120.05}
        var queryData = {
            longitude: String(result.longitude).match(/\d+\.\d{0,2}/)[0],
            latitude: String(result.latitude).match(/\d+\.\d{0,2}/)[0],
            channelType: '00'
        }

        var map = new BMapGL.Map("l-map")
        var point = new BMapGL.Point(Number(queryData.longitude),Number(queryData.latitude))
        map.centerAndZoom(point,13)

        var options = {
            onSearchComplete: function(results){
                    app.dealerName = results.getPoi(0).title;
            }
        };
        var local = new BMapGL.LocalSearch(map, options);
        local.search("奔驰");

    }).catch(err => {
        console.log(err)
    })

    // 百度地图API功能
    // var map = new BMapGL.Map("l-map");
    // var point = new BMapGL.Point(114.17, 30.36)
    // map.centerAndZoom(point,13)
    //
    //
    // var s = '';
    // var options = {
    //     onSearchComplete: function(results){
    //             s = results.getPoi(0).title;
    //     }
    // };
    // var local = new BMapGL.LocalSearch(map, options);
    // local.search("奔驰");
</script>
